<img alt="image" src="https://github.com/user-attachments/assets/018351c2-dd52-400c-8548-061a607784d1" />



本当に何もない時


<img alt="image" src="https://github.com/user-attachments/assets/cff09ec7-16e8-429b-9f73-5eebeb1e39e1" />


PieceUdon 72個

GetOwner.IsUserInVR 36個

PieceUpdate 72個

VRCPickup 72個

ObjectSync 72個

54フレームが出る

<img alt="image" src="https://github.com/user-attachments/assets/963cc896-6e0f-4393-bc71-3012ca4e25b8" />


PieceUdon 72個

GetOwner.IsUserInVR 36個

PieceUpdate 72個

VRCPickup 72個

ObjectSync 0個

63フレームが出る

<img alt="image" src="https://github.com/user-attachments/assets/95f6c4bf-f191-4257-91ae-d891fee8b36b" />


PieceUdon 72個

GetOwner.IsUserInVR 36個

PieceUpdate 72個

VRCPickup 0個

ObjectSync 0個

66フレームが出る


これくらいなら誤差範囲内
VRCPickupは性能差がないと見てもよいだろう

<img alt="image" src="https://github.com/user-attachments/assets/587260e0-1c70-4169-b7c1-7c40f61f5eca" />


PieceUdon 0個

GetOwner.IsUserInVR 0個

PieceUpdate 0個

VRCPickup 0個

ObjectSync 0個

今度はUdonを削除してアップロードしてみた

あれ？フレームが急に上がった

```

void Update()
{
    AngleHold();
}
void LateUpdate()
{
    AngleHold();
}
void AngleHold()
{
    if (Networking.GetOwner(gameObject).IsUserInVR())
    {
        GetComponent<Rigidbody>().constraints = 0;
    }
}
```

ちなみに中に入っていたコードはこれで、Update内で継続的に呼び出されていた

<img alt="image" src="https://github.com/user-attachments/assets/3a90ebb8-df41-4700-ab7b-bbd5623610af" />


PieceUdon 72個

GetOwner.IsUserInVR 0個

PieceUpdate 72個

VRCPickup 0個

ObjectSync 0個

```

void Update()
{
    AngleHold();
}
void LateUpdate()
{
    AngleHold();
}
bool isVR=false;
void AngleHold()
{
    if (isVR)
    {
        GetComponent<Rigidbody>().constraints = 0;
    }
}

public void UpdateIsVR()
{
    isVR = Networking.GetOwner(gameObject).IsUserInVR();
}

public override void OnPickup()
{
    UpdateIsVR();
}
```

あれ？このように変更してみたがそのままだった

つまり、GetOwner.IsUserInVRの問題ではなかった


<img alt="image" src="https://github.com/user-attachments/assets/4a3c8300-b528-474c-b93a-e534a362f654" />


```

void Update()
{
    AngleHold();
}
void LateUpdate()
{
    AngleHold();
}
void AngleHold()
{
    if (Networking.GetOwner(piece).IsUserInVR())
    {
        if (transform.localRotation != Quaternion.identity)
        {
            transform.localRotation = Quaternion.identity;
        }
    }
}
```

座標が変更された時のみ適用されるようにしたらフレームが上がった

それならObjectSyncの重さも理解できる

内部的に角度を固定するコードがあるはずだから

不思議な点は、通常のUnityでは座標と角度を変える程度は性能に何の影響もないということだ

rigidbodyが付いた状態で移動するからかと思ったが、rigidbodyを削除してもフレームが増加しなかった

VRChatだけの問題と見るのがよいだろう。内部的にLogでも呼び出しているのだろうか？

<img alt="image" src="https://github.com/user-attachments/assets/9bd8f1e2-0b74-4789-bd46-9d4f8e45275f" />


Manager、Piston、Stairにあったupdateに入っていたコードも0.5秒周期実行に変更してCPU使用量を60%軽減した

もうコード上でできる最適化は極限まで行った

今度は使用しない時はオブジェクトをオフにする方法で対応しよう